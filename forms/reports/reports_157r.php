<?

include_once("..\link\link.php");
	
	
	$year=$_POST['year_r'];
$where=' where  `ordinance`.`year_ordinance`="'.$year.'" ';
	switch ($_POST['period']){
	case (1): echo '<p>I &#1050;&#1074;&#1072;&#1088;&#1090;&#1072;&#1083; '.$year.' &#1075;&#1086;&#1076;&#1072;</p>';
	$where=$where.'  and (`ordinance_violation`.`Date_plan`>="'.$year.'-01-01" and `ordinance_violation`.`Date_plan`<"'.$year.'-04-01") ';
	break;
		case (2): echo '<p>II &#1050;&#1074;&#1072;&#1088;&#1090;&#1072;&#1083; '.$year.' &#1075;&#1086;&#1076;&#1072;</p>';
			$where=$where.'  and (`ordinance_violation`.`Date_plan`>="'.$year.'-03-01" and `ordinance_violation`.`Date_plan`<"'.$year.'-07-01") ';
			break;
			case (3): echo '<p>III &#1050;&#1074;&#1072;&#1088;&#1090;&#1072;&#1083; '.$year.' &#1075;&#1086;&#1076;&#1072;</p>';
				$where=$where.'  and (`ordinance_violation`.`Date_plan`>="'.$year.'-06-01" and `ordinance_violation`.`Date_plan`<"'.$year.'-09-01") ';
				break;
				case (4): echo '<p>IV &#1050;&#1074;&#1072;&#1088;&#1090;&#1072;&#1083; '.$year.' &#1075;&#1086;&#1076;&#1072;</p>';
					$where=$where.'  and (`ordinance_violation`.`Date_plan`>="'.$year.'-08-01" and `ordinance_violation`.`Date_plan`<"'.($year+1).'-01-01") ';
					break;
	}
	
$text_q='SELECT count( distinct`ordinance`.`num`) FROM `ordinance`
LEFT JOIN `ordinance_violation` ON `ordinance`.`id` = `ordinance_violation`.`id_ordinance` 
LEFT JOIN `link_ordinance_workers` ON `ordinance`.`id` = `link_ordinance_workers`.`id_ordinance`
LEFT JOIN `workers` ON `link_ordinance_workers`.`id_workers`= `workers`.`id` '.$where.' and `workers`.`id_department`=2';
//echo $text_q;
	$q_l_all=mysql_query ($text_q)or die (Mysql_error());	
		while ($r_l_all = mysql_fetch_row($q_l_all))
 {$l_all=$r_l_all[0];}	
$text_q='SELECT count( distinct`ordinance`.`num`) FROM `ordinance`
LEFT JOIN `ordinance_violation` ON `ordinance`.`id` = `ordinance_violation`.`id_ordinance` 
LEFT JOIN `link_ordinance_workers` ON `ordinance`.`id` = `link_ordinance_workers`.`id_ordinance`
LEFT JOIN `workers` ON `link_ordinance_workers`.`id_workers`= `workers`.`id` '.$where.' and `workers`.`id_department`=2 and `ordinance_violation`.`eliminated`=1';
	$q_l_i=mysql_query ($text_q)or die (Mysql_error());	
		while ($r_l_i = mysql_fetch_row($q_l_i))
 {$l_i=$r_l_i[0];}		
	
$text_q='SELECT count( distinct`ordinance`.`num`) FROM `ordinance`
LEFT JOIN `ordinance_violation` ON `ordinance`.`id` = `ordinance_violation`.`id_ordinance` 
LEFT JOIN `link_ordinance_workers` ON `ordinance`.`id` = `link_ordinance_workers`.`id_ordinance`
LEFT JOIN `workers` ON `link_ordinance_workers`.`id_workers`= `workers`.`id` '.$where.' and `workers`.`id_department`=1';
	$q_l_all=mysql_query ($text_q)or die (Mysql_error());	
		while ($r_l_all = mysql_fetch_row($q_l_all))
 {$g_all=$r_l_all[0];}	
$text_q='SELECT count( distinct`ordinance`.`num`) FROM `ordinance`
LEFT JOIN `ordinance_violation` ON `ordinance`.`id` = `ordinance_violation`.`id_ordinance` 
LEFT JOIN `link_ordinance_workers` ON `ordinance`.`id` = `link_ordinance_workers`.`id_ordinance`
LEFT JOIN `workers` ON `link_ordinance_workers`.`id_workers`= `workers`.`id` '.$where.' and `workers`.`id_department`=1 and `ordinance_violation`.`eliminated`=1';
	$q_l_i=mysql_query ($text_q)or die (Mysql_error());	
		while ($r_l_i = mysql_fetch_row($q_l_i))
 {$g_i=$r_l_i[0];}	
	
	if ($l_all==0){$l_p=0;}else{$l_p=(($l_i/$l_all)*100);}
		if ($g_all==0){$g_p=0;}else{$g_p=(($g_i/$g_all)*100);}
	
	echo '<table table width="100%"  border="2" align="center" cellpadding="0" cellspacing="0" bgcolor=#FFFFFF><tr><td width="25%"><p>&#1053;&#1072;&#1080;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077; &#1087;&#1086;&#1082;&#1072;&#1079;&#1072;&#1090;&#1077;&#1083;&#1103;</p></td><td align="center" width="25%"><p>%</p></td><td><p>&#1042;&#1089;&#1077;&#1075;&#1086; &#1087;&#1088;&#1077;&#1076;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1081; </p></td><td width="25%"><p>&#1048;&#1089;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1086; &#1087;&#1088;&#1077;&#1076;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1081; </p></td></tr>
	<tr>    <td height="384" width="191">&#1044;&#1086;&#1083;&#1103;    &#1080;&#1089;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1099;&#1093; &#1087;&#1088;&#1077;&#1076;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1081;, &#1074;&#1099;&#1076;&#1072;&#1085;&#1085;&#1099;&#1093; &#1086;&#1088;&#1075;&#1072;&#1085;&#1072;&#1084;&#1080; &#1075;&#1086;&#1089;&#1091;&#1076;&#1072;&#1088;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;&#1075;&#1086; &#1078;&#1080;&#1083;&#1080;&#1097;&#1085;&#1086;&#1075;&#1086; &#1085;&#1072;&#1076;&#1079;&#1086;&#1088;&#1072;    &#1074; &#1089;&#1074;&#1103;&#1079;&#1080; &#1089; &#1074;&#1099;&#1103;&#1074;&#1083;&#1077;&#1085;&#1085;&#1099;&#1084;&#1080; &#1085;&#1072;&#1088;&#1091;&#1096;&#1077;&#1085;&#1080;&#1103;&#1084;&#1080; &#1083;&#1080;&#1094;&#1077;&#1085;&#1079;&#1080;&#1086;&#1085;&#1085;&#1099;&#1093; &#1090;&#1088;&#1077;&#1073;&#1086;&#1074;&#1072;&#1085;&#1080;&#1081; &#1080; &#1089;&#1088;&#1086;&#1082; &#1080;&#1089;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1103;    &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1093; &#1087;&#1088;&#1080;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1085;&#1072; &#1086;&#1090;&#1095;&#1077;&#1090;&#1085;&#1099;&#1081; &#1087;&#1077;&#1088;&#1080;&#1086;&#1076;, &#1074; &#1089;&#1086;&#1086;&#1090;&#1085;&#1086;&#1096;&#1077;&#1085;&#1080;&#1080; &#1089; &#1086;&#1073;&#1097;&#1080;&#1084; &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;&#1084;    &#1074;&#1099;&#1076;&#1072;&#1085;&#1085;&#1099;&#1093; &#1087;&#1088;&#1077;&#1076;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1081; &#1074; &#1088;&#1072;&#1084;&#1082;&#1072;&#1093; &#1083;&#1080;&#1094;&#1077;&#1085;&#1079;&#1080;&#1086;&#1085;&#1085;&#1086;&#1075;&#1086; &#1082;&#1086;&#1085;&#1090;&#1088;&#1086;&#1083;&#1103; &#1089;&#1086; &#1089;&#1088;&#1086;&#1082;&#1086;&#1084; &#1080;&#1089;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1103; &#1085;&#1072;    &#1086;&#1090;&#1095;&#1077;&#1090;&#1085;&#1099;&#1081; &#1087;&#1077;&#1088;&#1080;&#1086;&#1076;</td>
	<td>'.$l_p.'</td><td>'.$l_all.'</td><td>'.$l_i.'</td></tr>
	<tr>
	 <td height="384" width="191">&#1044;&#1086;&#1083;&#1103;    &#1080;&#1089;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1099;&#1093; &#1087;&#1088;&#1077;&#1076;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1081;, &#1074;&#1099;&#1076;&#1072;&#1085;&#1085;&#1099;&#1093; &#1086;&#1088;&#1075;&#1072;&#1085;&#1072;&#1084;&#1080; &#1075;&#1086;&#1089;&#1091;&#1076;&#1072;&#1088;&#1089;&#1090;&#1074;&#1077;&#1085;&#1085;&#1086;&#1075;&#1086; &#1078;&#1080;&#1083;&#1080;&#1097;&#1085;&#1086;&#1075;&#1086; &#1085;&#1072;&#1076;&#1079;&#1086;&#1088;&#1072;    &#1074; &#1089;&#1074;&#1103;&#1079;&#1080; &#1089; &#1074;&#1099;&#1103;&#1074;&#1083;&#1077;&#1085;&#1085;&#1099;&#1084;&#1080; &#1085;&#1072;&#1088;&#1091;&#1096;&#1077;&#1085;&#1080;&#1103;&#1084;&#1080; &#1078;&#1080;&#1083;&#1080;&#1097;&#1085;&#1086;&#1075;&#1086; &#1085;&#1072;&#1076;&#1079;&#1086;&#1088;&#1072; &#1080; &#1089;&#1088;&#1086;&#1082; &#1080;&#1089;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1103; &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1093;    &#1087;&#1088;&#1080;&#1093;&#1086;&#1076;&#1080;&#1090;&#1089;&#1103; &#1085;&#1072; &#1086;&#1090;&#1095;&#1077;&#1090;&#1085;&#1099;&#1081; &#1087;&#1077;&#1088;&#1080;&#1086;&#1076;, &#1074; &#1089;&#1086;&#1086;&#1090;&#1085;&#1086;&#1096;&#1077;&#1085;&#1080;&#1080; &#1089; &#1086;&#1073;&#1097;&#1080;&#1084; &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086;&#1084; &#1074;&#1099;&#1076;&#1072;&#1085;&#1085;&#1099;&#1093;    &#1087;&#1088;&#1077;&#1076;&#1087;&#1080;&#1089;&#1072;&#1085;&#1080;&#1081; &#1074; &#1088;&#1072;&#1084;&#1082;&#1072;&#1093; &#1078;&#1080;&#1083;&#1080;&#1097;&#1085;&#1086;&#1075;&#1086; &#1085;&#1072;&#1076;&#1079;&#1086;&#1088;&#1072; &#1089;&#1086; &#1089;&#1088;&#1086;&#1082;&#1086;&#1084; &#1080;&#1089;&#1087;&#1086;&#1083;&#1085;&#1077;&#1085;&#1080;&#1103; &#1085;&#1072; &#1086;&#1090;&#1095;&#1077;&#1090;&#1085;&#1099;&#1081;    &#1087;&#1077;&#1088;&#1080;&#1086;&#1076;</td>
 	<td>'.$g_p.'</td><td>'.$g_all.'</td><td>'.$g_i.'</td></tr>
	
	
	</table>';
	

?>